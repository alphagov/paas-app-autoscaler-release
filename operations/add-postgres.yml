
- type: replace
  path: /domains/postgres
  value: &postgres_domain ((deployment_name)).autoscalerpostgres.service.cf.internal

- type: replace
  path: /addons/name=bosh-dns-alises/properties/aliases/-
  value:
    domain: *postgres_domain
    targets:
      - query: '*'
        instance_group: postgres
        deployment: ((deployment_name))
        network: default
        domain: bosh
# Postgres Instance Group
- name: postgres
  azs:
    - z1
  instances: 1
  update:
    serial: true
  stemcell: default
  vm_type: small
  networks:
    - name: default
  jobs:
    - name: postgres
      release: postgres
      properties:
        databases: &database
          sslmode: verify-full
          tls:
            ca: ((postgres_ca.ca))
            certificate: ((postgres_server.certificate))
            private_key: ((postgres_server.private_key))
          databases:
            - name: autoscaler
              tag: default
          db_scheme: postgres
          address: *postgres_domain
          port: 5432
          roles:
            - name: postgres
              password: "((database_password))"
              tag: default
          connection_config: &databaseConnectionConfig
            max_open_connections: 100
            max_idle_connections: 10
            connection_max_lifetime: 60s
