<%
  def p_arr(property)
    p(property,nil) || []
  end

  job_name = 'scalingengine'
  scaling_engine_db_url = build_db_url('scalingengine_db', job_name)
  policy_db_url = build_db_url('policy_db', job_name)
  scheduler_db_url = build_db_url('scheduler_db', job_name)%>

cf:
  api:  <%= p("autoscaler.cf.api") %>
  client_id: <%= p("autoscaler.cf.client_id") %>
  secret: <%= p("autoscaler.cf.secret") %>
  skip_ssl_validation: <%= p("autoscaler.cf.skip_ssl_validation") %>
  max_retries: <%= p("autoscaler.cf.max_retries") %>
  max_retry_wait_ms: <%= p("autoscaler.cf.max_retry_wait_ms") %>
  idle_connection_timeout_ms: <%= p("autoscaler.cf.idle_connection_timeout_ms") %>
  max_idle_conns_per_host_ms: <%= p("autoscaler.cf.max_idle_conns_per_host_ms") %>


server:
  port:  <%= p("autoscaler.scalingengine.server.port") %>
  tls:
    key_file: /var/vcap/jobs/scalingengine/config/certs/scalingengine/server.key
    cert_file: /var/vcap/jobs/scalingengine/config/certs/scalingengine/server.crt
    ca_file: /var/vcap/jobs/scalingengine/config/certs/scalingengine/ca.crt

logging:
  level: <%= p("autoscaler.scalingengine.logging.level") %>
http_client_timeout: <%= p("autoscaler.scalingengine.http_client_timeout") %>
health:
  port: <%= p("autoscaler.scalingengine.health.port") %>
  username: <%= p("autoscaler.scalingengine.health.username") %>
  password: <%= p("autoscaler.scalingengine.health.password") %>

db:
  policy_db:
    url: <%= policy_db_url %>
    max_open_connections: <%= p("autoscaler.policy_db_connection_config.max_open_connections") %>
    max_idle_connections: <%= p("autoscaler.policy_db_connection_config.max_idle_connections") %>
    connection_max_lifetime: <%= p("autoscaler.policy_db_connection_config.connection_max_lifetime") %>
  scalingengine_db:
    url: <%= scaling_engine_db_url %>
    max_open_connections: <%= p("autoscaler.scalingengine_db_connection_config.max_open_connections") %>
    max_idle_connections: <%= p("autoscaler.scalingengine_db_connection_config.max_idle_connections") %>
    connection_max_lifetime: <%= p("autoscaler.scalingengine_db_connection_config.connection_max_lifetime") %>
  scheduler_db:
    url: <%= scheduler_db_url %>
    max_open_connections: <%= p("autoscaler.scheduler_db_connection_config.max_open_connections") %>
    max_idle_connections: <%= p("autoscaler.scheduler_db_connection_config.max_idle_connections") %>
    connection_max_lifetime: <%= p("autoscaler.scheduler_db_connection_config.connection_max_lifetime") %>

defaultCoolDownSecs : <%= p("autoscaler.scalingengine.defaultCoolDownSecs") %>
lockSize : <%= p("autoscaler.scalingengine.lockSize") %>

