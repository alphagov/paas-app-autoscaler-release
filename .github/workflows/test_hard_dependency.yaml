name: Test failing workflows early
on:
  pull_request:
    types: [ opened, labeled, synchronize ]
    paths:
      - 'src/acceptance/**'

# env:
#   MAVEN_VERSION: 3.6.3
#   MAVEN_SHA: c35a1803a6e70a126e80b2b3ae33eed961f83ed74d18fcd16909b2d44d7dada3203f1ffe726c17ef8dcca2dcaa9fca676987befeadc9b9f759967a8cb77181c0
#   BUILDIN_MODE: true
#   SERVICE_OFFERING_ENABLED: false
#   check_name: "acceptance-test-check-buildin"
#   PR_NUMBER: "${{ github.event.pull_request.number }}"
#   DEPLOYMENT_NAME: "autoscaler-${{ github.event.pull_request.number }}"
#   SERVICE_BROKER_NAME: "autoscaler-${{ github.event.pull_request.number }}servicebroker"
#   SERVICE_NAME: "autoscaler-${{ github.event.pull_request.number }}"
#   BBL_STATE_PATH: "${{ github.workspace }}/bbl/bbl-state"
#   NAME_PREFIX: "autoscaler-${{ github.event.pull_request.number }}-TESTS"
#   GINKGO_OPTS: "--fail-fast"
#   NODES: 3
#   AUTOSCALER_DIR: "${{ github.workspace }}/app-autoscaler-release"
#   CI_DIR: "${{ github.workspace }}/app-autoscaler-release/ci"

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  job_1:
    name: "Job 1"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          path: app-autoscaler-release
      - name: "Let the workflow fail"
        run: |
          echo '::set-output name=workflow_conclusion::failure'
          exit 1

  job_2:
    needs: [ job_1 ]
    name: "Job 2 (dependent on Job 1)"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          path: app-autoscaler-release
      - name: deploy autoscaler
        run: |
          echo 'I succeed always!'
          exit 0